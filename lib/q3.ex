defmodule Q3 do

  def solve do
    configs = [%{right: 1, down: 1}, %{right: 3, down: 1}, %{right: 5, down: 1}, %{right: 7, down: 1}, %{right: 1, down: 2}]

    #Enum.each(configs, fn con -> traverseMap(con) end)

    Enum.reduce(configs, 1, fn conf, acc -> acc * traverseMap(conf) end)
  end

  def traverseMap(config) do
    map = parseMap()

    right_amount = config.right
    down_amount = config.down

    map_length = map |> Enum.count()
    #each new position is going to be 3*rownumber

    tree_count =  for i <- 1..map_length do
                    i_ = i * down_amount
                    if i_ < map_length do
                      row = map |> Enum.at(i_) |> to_string()
                      pos = i*right_amount
                      isTreeAtPos(row, pos)
                    else
                      nil
                    end
                  end

    freq = Enum.frequencies(tree_count)
    IO.inspect(freq[true])
    freq[true]
  end

  def getRealPos(mapbit, pos) do
    length = String.length(mapbit)
    if pos > length do
      rem(pos, length)
    else
      pos
    end
  end

  def isTreeAtPos(mapbit, pos) do
    tree = "#"
    real_pos = getRealPos(mapbit, pos)

    String.at(mapbit, real_pos) === tree
  end

  def parseMap do
    map = "....#...............#.#..###.##
    .#..#....###..............##...
    ....###......#....#.#...#.##..#
    .......#........#..###...##....
    .....#..#......#..#..##..#...#.
    ....#..........#....#...#......
    ............###...#............
    ##......#.....#......#.....##..
    ........#.........##..#.#...##.
    ....#.#..#.#...#........#..#...
    .#.....#.#......#....#..#..#..#
    #.##..##......#.....##...#..#..
    #........#..##...###....##.....
    ......#.#..##...#.#.....#......
    ##.......#..#.........#...#....
    .....##.........#....#.#.###.#.
    ..##...........#.#.#.#.....#.#.
    ....#...............#......#.#.
    #.#..#....#.....#.....##...#..#
    #......#..............#.#.##...
    ......###.....#...#........###.
    ####...#.....#...#....#........
    .......#...#....##...#.........
    .####..##............#.........
    #.#...#...#....#...#.#......#..
    ..#..#.....#.......#...#.#...##
    .#.........#...#......##.#...#.
    .#.#...#...#.....#.#........#.#
    .#.....###....###..##.#..##.#..
    .....##....#......#..#...#...#.
    #...##....#.......#.....##.##..
    #...#.....#.#...........#..###.
    ##.#........###...........###.#
    #...#.#........#.#.....#.......
    ..................#..#.........
    .....#.#..#.#......#..#.....##.
    .#.#.......#..##........#..##.#
    .#.#..#.#...#.......#.#.#..#...
    ...#......#....#....##.#..#....
    ......#.......##....##..#.....#
    ...#.##...##...............#..#
    .###....#.#.....##..#.......#.#
    #....#..........#...........#.#
    ...#...............#.#..#....#.
    .....#..##..........#..###.....
    .....####.....#.#.......#...#..
    #.............#...#.......##...
    .#....##.......#.#......#.#.##.
    .#..#.......#..##...#...#......
    #.......#..#..#..#.....#.......
    ##...#.#.#...........#....#....
    .......#..#.#..............#.#.
    .....#.......#.......#.#.#.....
    ....##.##.....#......#.......#.
    #...#..#.#....###....##...#.#.#
    #..#......#........#.#.#.....#.
    ###..##..#......#.....#.......#
    ..##....#.#.#......#..##...#...
    .....#..#....#...#.#...#...#...
    .....#.#..###.#..#...##......#.
    #.#..#....#..#.....#.#...#.#...
    .#..#....#.......#..#.......#..
    #.........#..#..#.........##..#
    ..##.##..#..#...##.............
    .....###...#..#...##.#..#......
    #.##.....##..............#.....
    .......#.##.#.##...#.#.......##
    ...#.#.##...#......#...........
    ##.#........#.....##.....#.....
    .#.....#.............#......#..
    ....#..##..#..#....#..#.#......
    .#.....#....##..##..#...##.....
    .##........#.#.#.#..........#.#
    ...#.#.#..#....#...#..###.##...
    .#....#....#.#.#.#....#..#.....
    #.#.......#..#..#...........#.#
    .....#.....##..#....##.........
    ....#.##..............#........
    .................#....#.......#
    ...................###...#...#.
    ...#.#..#..##..##....#.....#...
    #...#..........................
    .......#..#..#.#..#.....#......
    ..##.#..#......#...#.##..##..#.
    .##.........#.#...........#....
    ...#...#..##.#......#..#..#....
    .....#.#....#...#............#.
    .##..#.....##....#...#.........
    #......##...#...#............#.
    .....#.##...#.#....##..........
    .............#.......#.#.......
    ##....#.#........#....#..##....
    ....#...##.#....##..#.....#.#..
    ...##..#....##......#...#......
    .####.#..#..#.#...#.#.#....#...
    .#........#.##....#.#....#.....
    .........#....##..#..#.........
    ....##...#....##.............#.
    ....#..##.#....#.#..#...##.....
    .....##...#..#....#......#.#...
    ..........#.......#.##..#.##..#
    .......#.........#...#.##......
    ....##.#.......#...............
    ....#.......#..##.......##.#.##
    #.#..#.#....#.#.........###...#
    .#.##.....##..##...........#.#.
    ...#....##........##...#...#...
    .#.##....#.#...#.#..#..#...#...
    #....#.##...#.#..#....#.....#..
    #..#...#........#...........#..
    ...........#.......#......#..#.
    ....##...#......##.....#......#
    .#.##.#.#.............#....##..
    .#...#...##.#.#........#..##.#.
    .#.#........#.#...#..#........#
    .###.#.#...#..#..#.#....#..#...
    ..##..##....#.#............#...
    #..........#........#..#.#.#...
    .#...#..#..#.#.....#.....#....#
    #.....#.#.#.....####.......#...
    ...#.#........#.#.###...#.....#
    .....#.....##....#....#..##...#
    ..#....###.##.#..#..#....#...#.
    .....#.....#...........#.#.###.
    .....#......###...#.#...##.....
    ...........###..#...#....#.#..#
    ...#..###.....#....#.#...#.....
    .......#...#..#..##....#.#.#...
    ...#..####.###........#.....#..
    ..#......###..#..#.##..........
    ....#....##..##..##.......###..
    ...#.......#..#.#....##........
    .#.#.....#.#.#..........#..#..#
    .##....##....##...........##.##
    ........#......#.##....##...#.#
    ..#.#.....#..#....#..........#.
    ...........#...............#...
    .....####.....#.....###.#..#...
    ..........####..##.##.#....#...
    ...#.#.#......#....#..#.#......
    .#.#......###.....#....#.......
    ..#..#..#.......#..#...#.....#.
    ...#............#......##...###
    ......#.............#..#..###..
    .#.#......#..##.#..#..#.#...#.#
    .#.....#.......#..#...........#
    ..#.###.#..#...#.##..#.##......
    ....#.#........#..#.#...#.#.##.
    .#..##.#..#.#.#...##..#.#......
    .......#..#..#..#.....#.#.#..#.
    .##.###..##.....#.##..#........
    ...##..............#.#.##....#.
    ##....#...#...........#........
    ..#........#.#.##..#.#...#..#..
    .......#.......##.#..#....#.#..
    .......#....##..#.#.#..#....#..
    ..........#....#..#..#....#....
    ........#.....#.#.....##.......
    ........##.###.........#.#.#...
    ###......####...#.#........#...
    ......#........#......#.....#..
    ##..#.##..##.###..#........##..
    .#..#...#............##.##..#..
    ...........#..#.#..............
    .##.#.#....#...............#..#
    .........##.................#..
    #............##..##.........##.
    ##........#.........#..##.#...#
    ........#.....#..#.........#.##
    ....#......#.....##.##.........
    .#.#.....#.#..#..##....#....#..
    .###...#..##....##.....#.#..##.
    .#....#.#.......#..#..#...###..
    ..#.#......#.#..#.....###.....#
    #....#..#...#.....#.......#.##.
    .#.......##.#.#...#......#.....
    ###....#.#......#....#.#...##..
    ...#....####.......##.....#..#.
    .#.................#.......##.#
    ...#.###..........#..##......#.
    .....##.#..............##..#...
    #.....#..#..........#..#.......
    ..#...#.#.#.......##.#.....#...
    #........#.#........#.#.....#..
    #.....#...##....##..##........#
    .#.##..#...#....#........#..#..
    #..#.....#....#...##......#....
    ...#...#...#.#.#....##....#.#.#
    ......#...............#.....#..
    .......#.#..#..##.#.....#......
    ...........##......#...#.......
    ....##..##.....#.#...#.........
    ......##..###.......#....#.##..
    ......#..#.##....#..###..#.....
    .....#.........#........##.....
    .....####..................#...
    .#.#...##................#.....
    .#..#...#...#.....#.##..#..#...
    .#................#...###....#.
    ...#....#...........#...#....#.
    .......#....##...............#.
    .#.#.##..##.......#....#....###
    ......#.#....#...#..#..........
    ....#.##.#.#...##.#.#......#...
    ##....#...##.....#..#.###.#....
    .......#......#.........#.#...#
    .##.#...........##.........#.#.
    ##..##.....#...#..#.#...#....#.
    #..##......###........#...#....
    .....#.#.......#...#..##....##.
    .....#.#..#.....#.......#..##..
    ...#..#..............#.#.......
    .#.#...###......###............
    .....#.....#...#.###...........
    .......#..................#...#
    #....#...#...#....#....#.#....#
    ....#..#............#.#........
    #....#..........#.#.#..#..#....
    .......#....#......#....#......
    .##.#.#...#...#...##...........
    .........###.#..#..............
    ...#........##....#....#....###
    ....##..#.......#.#...#.#..#.#.
    .....##....#..##.........#.....
    ........##..#........#.........
    ...........#..#.##..##...#.....
    .........#.#..####..#...#.##.##
    ##..#.#.....##.....#.........#.
    ..#...#...#....#.#....#.....#.#
    .###.#....#.#......#....#......
    .##.....#....#.......#.#..#.##.
    #..#..##.....#....#...##.....#.
    ...#.........####.........##..#
    ..#.....#....###.#.#...#..#....
    .........#....#..#.#.........#.
    .....###.##..#...#.....#..#..#.
    ....#......#..#.#...#.....#....
    .......#...#..#....#.......#.#.
    .#....#............#....####...
    #..##..##....#.....#...#.....#.
    ...#...##...#.#....#...........
    .......#####.....#..###.#..#...
    .....#.....#.#....#.........#..
    .###.#..#...##.##.#.#..#..#....
    .#..#.##..#......#..........##.
    ##....#....#.........###..#....
    ..#.............#.......#.#....
    ..#.....#..##...#...###..#.##..
    ##...##...#.#....#..#..........
    ...............#.....#.......#.
    ....#.#......##.#......#...#.#.
    .........#.............#.#.....
    ...#.#.........................
    ..#..#....##..#...###.##.......
    ...##.#...##..#.#.##.#...#.##..
    .##....#....#.......#.....##..#
    .#...............#..#...#......
    ...##.....##.###....#.....#...#
    ...#.....#...####....##....#..#
    ..#.#.###..##.....#........#...
    .....##.##..#..#.........##....
    ........##.....#..........#.##.
    ..##.#....####..#...........#..
    ##....#..#..#.#.##.....#...##..
    ...#...#......#..#.#....#......
    ##.....##.......##.##....#.....
    .........#...##...........#....
    .###.#..#....##...#.....#.....#
    ...#..........#.###..##...#.##.
    ...#..#....#.#.#.......###.....
    ....#..#.#.....##...#.#.#.#....
    .......##..#...##..##.#....#...
    .##..........#.#.#.....#.....#.
    #....#......##...#..##.#..#..#.
    .#...#.....###..#......#.....#.
    .#..#.###.......#.##....###....
    #....#....#....#....#..#.##....
    ..#..#.....#.....#....###.....#
    ##.###..#...##.......#.#.......
    #...##......##....#.#...#....#.
    ..##.#.#....#...#.....##.......
    .#....#..#...#...##..##........
    ###......#.##....#.#..##.......
    ...#.....##.#.........#..#.....
    .......#.#....#.....##......#..
    #..#..............##.#........#
    ....#.#....#..#.#...##.........
    ..........#..........#.........
    .#.....#.....#.##....#.##..#..#
    .......#.......#.#.#.##....#...
    ..#...........#....#.......##..
    ..#.#.#.#...##..#.#.#..#...#.#.
    ..#..#..........#...##....#....
    ....##.#....#.............#....
    .##...##..........#.#..#...#...
    #..#..#.##..........##.........
    ............#.......#..#.....##
    ....#......#........#..#.##....
    #.#......#.#...#.....#.........
    ..#.....#..#..........#.....#..
    .#..#.#.#.##...#..#.#.........#
    #...##....#..##..#...#.#.##....
    #..##.##.#.##.......#.......#..
    #.#.......#........#.##....#.#.
    ....#..##....##..##......#..##.
    #.....#....#.#........####.....
    ......#...#...###..#...........
    .##.#.##...##................##
    ..##.#.....#.#..#......#.#.....
    ......#...#........#.....#.##..
    #..#.#..#.....#.#..#..##..#.#..
    ...#.........#.#.#.##...#......
    ...#..##....#..#.#....#.###.#..
    ........###................##.#
    ##...........#......##.##.....#
    .#.#.#....#....#....#..........
    #.....#........................
    ....#.....#...#......#.........
    ....#.#..#..............#......
    ##.........#..#....#.......#...
    .###....#..#.#.####.........#..
    ..#.#....#.....###..#..........
    ..........#................#.##"

    String.split(map)
  end

end
